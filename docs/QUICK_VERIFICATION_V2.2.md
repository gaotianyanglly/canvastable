# 快速验证指南 - v2.2 悬停状态修复验证

## 🚀 启动测试

```bash
npm run dev
```

访问：`http://localhost:8080`

---

## ✅ 验证 1：悬停状态保留（核心修复）

### 测试步骤
1. 将鼠标移动到表格的第1行上（不要点击）
2. **观察**：整个第1行的所有单元格变为浅蓝色背景 ✅
3. 保持鼠标在第1行上，点击第1行的第2列单元格
4. **观察**：
   - 第1行第2列显示蓝色边框（选中状态）✅
   - 第1行的其他单元格仍然保持浅蓝色背景（悬停状态）✅
5. 保持鼠标在第1行上，点击第2行的第3列单元格
6. **观察**：
   - 第2行第3列显示蓝色边框（选中状态）✅
   - **关键验证**：第1行仍然保持浅蓝色背景（悬停状态保留）✅
7. 将鼠标移开第1行
8. **观察**：第1行的背景色变为白色 ✅

### 预期结果
- ✅ 悬停状态在选择操作后仍然保留
- ✅ 鼠标移开后悬停状态正确清除
- ✅ 没有背景色闪烁或跳变

### 如果失败
- ❌ 第1行在步骤6后变为白色 → Bug未修复

---

## ✅ 验证 2：悬停 + 编辑状态组合

### 测试步骤
1. 点击 **"✏️ 编辑(2,3)"** 按钮
2. **观察**：第2行第3列左上角出现红色小三角形 ✅
3. 将鼠标移动到第2行上
4. **观察**：
   - 第2行所有单元格变为浅蓝色背景 ✅
   - 第2行第3列的红色小三角形仍然存在 ✅
5. 保持鼠标在第2行上，点击第2行第3列
6. **观察**：
   - 第2行第3列显示蓝色边框（选中状态）✅
   - 第2行保持浅蓝色背景（悬停状态）✅
   - 红色小三角形仍然存在（编辑状态）✅
7. 点击其他单元格（例如第3行第3列）
8. **观察**：
   - 第2行仍然保持浅蓝色背景（悬停状态保留）✅
   - 第2行第3列的红色小三角形仍然存在（编辑状态保留）✅

### 预期结果
- ✅ 悬停状态、选中状态、编辑状态可以同时存在
- ✅ 清除选中状态后，悬停状态和编辑状态都保留
- ✅ 三种状态互不干扰

---

## ✅ 验证 3：快速切换测试

### 测试步骤
1. 快速将鼠标在不同行之间移动
2. 在移动过程中随机点击单元格
3. **观察**：
   - 悬停的行始终保持浅蓝色背景 ✅
   - 选中的单元格显示蓝色边框 ✅
   - 没有背景色残留或错误 ✅

### 预期结果
- ✅ 快速操作时状态管理正确
- ✅ 没有视觉闪烁或错误

---

## ✅ 验证 4：程序化操作测试

### 测试步骤
1. 将鼠标移动到第2行上（保持悬停）
2. 点击 **"🎯 选中(2,3)"** 按钮
3. **观察**：
   - 第2行第3列被选中（蓝色边框）✅
   - 第2行保持浅蓝色背景（悬停状态）✅
4. 点击 **"✏️ 编辑(2,3)"** 按钮
5. **观察**：
   - 第2行第3列出现红色小三角形 ✅
   - 第2行保持浅蓝色背景（悬停状态）✅
6. 点击 **"🎯 选中(2,3)"** 按钮（再次点击）
7. **观察**：
   - 第2行保持浅蓝色背景（悬停状态保留）✅
   - 红色小三角形仍然存在（编辑状态保留）✅

### 预期结果
- ✅ 程序化操作不影响悬停状态
- ✅ 所有状态正确保留

---

## ✅ 验证 5：边界情况测试

### 测试用例 5.1：悬停后立即点击
```
1. 鼠标快速移动到某行并立即点击
2. 验证：悬停状态正确建立并保留 ✅
```

### 测试用例 5.2：多次选择同一单元格
```
1. 悬停在第1行
2. 点击第1行第2列
3. 再次点击第1行第2列
4. 验证：第1行保持浅蓝色背景 ✅
```

### 测试用例 5.3：清除所有状态
```
1. 悬停在第1行
2. 标记第1行第2列为已编辑
3. 选中第1行第2列
4. 点击 "🧹 清除所有编辑状态" 按钮
5. 验证：
   - 红色三角形消失 ✅
   - 第1行保持浅蓝色背景（悬停状态保留）✅
```

---

## 📊 验证结果记录表

| 验证项 | 状态 | 备注 |
|--------|------|------|
| 悬停状态保留 | ⬜ | 核心修复验证 |
| 悬停+编辑状态组合 | ⬜ | 状态独立性验证 |
| 快速切换测试 | ⬜ | 性能和稳定性验证 |
| 程序化操作测试 | ⬜ | API 正确性验证 |
| 边界情况测试 | ⬜ | 鲁棒性验证 |

**填写说明：**
- ✅ = 通过
- ❌ = 失败
- ⚠️ = 部分通过

---

## 🐛 常见问题排查

### 问题 1：悬停状态仍然丢失
**可能原因：**
- 代码未正确编译
- 浏览器缓存

**解决方法：**
```bash
# 清除缓存并重新编译
npm run clean
npm run dev
```

### 问题 2：红色三角形消失
**可能原因：**
- 编辑状态被错误清除
- 渲染问题

**解决方法：**
1. 检查操作日志是否显示"已标记"
2. 尝试刷新页面
3. 检查浏览器控制台是否有错误

### 问题 3：背景色闪烁
**可能原因：**
- 状态更新频率过高
- 渲染优化问题

**解决方法：**
1. 检查是否有多次重复的 render 调用
2. 查看浏览器性能分析工具

---

## 🎯 快速检查清单

- [ ] 启动测试页面成功
- [ ] 鼠标悬停时行背景变为浅蓝色
- [ ] 点击单元格后悬停状态保留
- [ ] 编辑状态独立于悬停状态
- [ ] 程序化操作正确
- [ ] 快速操作时无闪烁
- [ ] 无 JavaScript 错误
- [ ] 无 TypeScript 类型错误

---

## 📝 验证报告模板

```
验证日期：____________________
验证人员：____________________

验证结果：
1. 悬停状态保留：[ ] 通过 [ ] 失败
2. 悬停+编辑状态组合：[ ] 通过 [ ] 失败
3. 快速切换测试：[ ] 通过 [ ] 失败
4. 程序化操作测试：[ ] 通过 [ ] 失败
5. 边界情况测试：[ ] 通过 [ ] 失败

问题记录：
_________________________________________________
_________________________________________________
_________________________________________________

总体评价：[ ] 全部通过 [ ] 部分通过 [ ] 未通过

签名：____________________
```

---

## 🔍 调试技巧

### 查看悬停状态
在浏览器控制台输入：
```javascript
// 获取所有悬停的单元格
table.selectionManager.getHoveredCells()

// 检查特定单元格是否悬停
const cell = table.body.rows[0].cells[0];
table.selectionManager.isCellHovered(cell)
```

### 查看所有状态
```javascript
console.log('选中的单元格:', table.selectionManager.getSelectedCells());
console.log('悬停的单元格:', table.selectionManager.getHoveredCells());
console.log('已编辑的单元格:', table.selectionManager.getEditedCells());
```

---

**验证时间：** 约 10-15 分钟  
**难度等级：** ⭐⭐⭐☆☆（中等）  
**建议环境：** Chrome/Edge 最新版本  
**关键验证点：** 悬停状态保留（验证1）

